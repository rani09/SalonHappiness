@using PagedList;
@using PagedList.Mvc;
@model IPagedList<SalonHappiness.Models.Booking>
@using SalonHappiness.Models;
@{
    ViewBag.Title = "Booket tider";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<section class="section-padding--large bg-white">
    <div class="container">
        <div class="section-intro pb-70px">
            <h4 class="section-intro__title">Oversigt over</h4>
            <h2 class="section-intro__subtitle">Dine tider hos Salon Happiness</h2>
        </div>
        <div class="row">
            <div class="col-md-3">
                @Html.Action("_CustommerMenu", "CustomerCenter", new SalonHappiness.Models.Booking())
            </div>
            <div class="col-md-9">
                <table class="table table-striped table-hover table-responsive" id="testtable">
                    <thead>
                        <tr>
                            <th>Brugernavn</th>
                            <th>Dato</th>
                            <th>Tid</th>
                            <th>Status</th>
                            <th>Oprettet</th>
                            <th>Ombooke</th>
                            <th>Afbooke</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@Html.DisplayFor(modelItem => item.User.Fname)</td>
                                <td>@Html.DisplayFor(modelItem => item.ArrivelDate)</td>
                                <td>@Html.DisplayFor(modelItem => item.ArrivelTime)</td>
                                <td>@Html.DisplayFor(modelItem => item.Status)</td>
                                <td>@Html.DisplayFor(modelItem => item.DateCreated)</td>
                                <td><a href="#" class="btn btn-success" onclick="EditBooking(@item.BookingId)"><i class="fas fa-edit"></i></a></td>
                                <td>
                                    @using (Html.BeginForm("DeleteBooking", "CustomerCenter", new { id = item.BookingId }, FormMethod.Post))
                                    {
                                        @Html.AntiForgeryToken()
                                        <div class="form-actions no-color">
                                            <a href="#" value="Slet" class="btn btn-danger" onclick="return functionConfirm(this)"><i class="fas fa-trash-alt"></i></a>
                                        </div>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
                @Html.PagedListPager(Model, Page => Url.Action("BooketTime", new { Page }), new PagedListRenderOptions() { DisplayPageCountAndCurrentLocation = true })
            </div>
        </div>
    </div>
</section>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Redigere Tiden</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="myModalBodyDiv">
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="BookingId" />
@section scripts{
    <script type="text/javascript">
        function functionConfirm(event) {
            swal({
                title: "Er du sikker?",
                text: "Du kan ikke gendanne denne booking!",
                type: "warning",
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Ja, slet det!",
                cancelButtonText: "Nej, annuller venligst!",
                cancelButtonClass: "btn-secondary",
                showCancelButton: true,
                closeOnConfirm: false,
                closeOnCancel: false,
                showLoaderOnConfirm: true
            }, function (isConfirm) {
                if (isConfirm) {
                    swal({
                        type: "success",
                        title: "Slettet",
                        text: "Din tidsbestilling er blevet slettet",

                        timer: 3000,
                        showConfirmButton: false
                    });
                    setTimeout(
                        function () {
                            $('form').submit();
                        }, 3000);
                } else {
                    swal("Annulleret", "Din tidsbestilling belv ikke slettet 😊", "error");
                    return false;
                }
            });
            return false;
        }
    </script>
    <script>
        var EditBooking = function (bookingId) {
            var url = "/CustomerCenter/EditBooking?bookingId=" + bookingId;
            $("#myModalBodyDiv").load(url, function () {
                $("#myModal").modal("show");
            })
        }
    </script>

}